<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <title>NPBC-Monitor</title>
    <!-- Bootstrap core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

    <script type="text/javascript">
	window.onload = function () {

		// dataPoints
		var dataPoints1 = [];

		var chart = new CanvasJS.Chart("chartContainer",{
			zoomEnabled: true,
			title: {
				text: ""
			},
			toolTip: {
				shared: true

			},
			legend: {
				verticalAlign: "top",
				horizontalAlign: "center",
                                fontSize: 14,
				fontWeight: "bold",
				fontFamily: "calibri",
				fontColor: "dimGrey"
			},
			data: [{
				type: "line",
				xValueType: "dateTime",
				showInLegend: true,
				name: "Power",
				dataPoints: dataPoints1
			}],
                        legend:{
                          cursor:"pointer",
                          itemclick : function(e) {
                            if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                              e.dataSeries.visible = false;
                            }
                            else {
                              e.dataSeries.visible = true;
                            }
                            chart.render();
                          }
                        }
		});

		var updateInterval = 5000;

		var updateChart = function (count) {
                    $.getJSON("/api/getStats", function(data) {
                         dataPoints1.length = 0;
                         $.each(data, function(key, value) {
                             dataPoints1.push({x: Date.parse(value.Timestamp), y: value.Power});
                         });

                         chart.render();
                    });
		};

		updateChart();
		 
		// update chart after specified interval 
		setInterval(function(){updateChart()}, updateInterval);
	}
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
  </head>
  <body>
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li class="active"><a href="#home" role="tab" data-toggle="tab">Home</a></li>
      <li><a href="#settings" role="tab" data-toggle="tab">Settings</a></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      <div class="tab-pane active" id="home">
        <div class="panel-group">

          <div class="panel panel-default">
            <div class="panel-heading">Current state</div>
            <div class="panel-body">
              <button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-fire"></span> Flame</button>
              <button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-star"></span> Power</button>
            </div>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Last 12 hours stats</div>
            <div class="panel-body">
              <div id="chartContainer" style="height: 500px; width: 80%;"></div>
            </div>
          </div>

        </div>
      </div>
      <div class="tab-pane" id="settings">...</div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  </body>
</html>